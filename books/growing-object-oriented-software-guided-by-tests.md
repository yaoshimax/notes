## 実践テスト駆動開発を読んでメモ
### 序文
- 英語タイトル「Growing Object-Oriented Software, Guided By Tests」の意味
  - なぜ`Growing`かというと、ソフトウェアをインクリメンタルに開発するもの感をだしたかったから
  - なぜ`Guided`かというと、テストを先に書くというプロセスがソフトウェアの設計を支援するものだから。
- 本の構成
  - 第１部「導入」：テストフレームワークの紹介など
  - 第２部「テスト駆動開発のプロセス」：プロセスの説明
  - 第３部「動くサンプル」：応用的なサンプル
  - 第４部：持続可能なテスト駆動開発」：システムをメンテ可能な状態に保つプラクティス
  - 第５部「高度なトピック」：テスト駆動開発の実践が困難な領域について
  - 付録：jMockとHamcrestの解説
### 第一部
#### 第一章「テスト駆動開発のポイントとは？」
- テスト駆動開発の核心サイクルは「失敗するユニットテストを書く」「通るようにする」「リファクタリングする」からなる
  - テストを書くことによる恩恵
    - 次の作業の受け入れ基準が明確
    - 疎結合が促される
    - コードが何をするかの説明になる
    - 網羅的なリグレッションテストスイートを厚くできる
  - テストを実行することによる恩恵
    - 早期のエラー検出ができる
    - 将来必要かも…と当面不要な柔軟性を持たせなくなる
- 初手ユニットテストを書く、のは誤り
  - 最初に書くのは「受け入れテスト」。新規追加機能を利用するテスト。
    - 可能な限りエンドツーエンドテストにするべき
  - これを通すための小さなサイクルがユニットレベルのテスト/実装/リファクタサイクル
  - 筆者はテストの種類を以下３種類に分類。受け入れ・インテグレーションのテクニックは紹介せず3章で例示するのみにとどめているらしい(∵採用技術や組織の文化で大きく違うから）
    - 受け入れテスト（何を構築するのかの理解・合意）
    - インテグレーションテスト（変更不可の領域(世間一般のフレームワーク・外部提供のライブラリ等）と合わせても動作するか）
    - ユニットテスト
- エンドツーエンドは外側の品質を保つものであるのに対し、ユニットテストは内側の品質（理解しやすさ、変更しやすさ）を保つためのもの
#### 第二章「オブジェクトをテスト駆動開発する」
- 値とオブジェクト
  - 値：状態不変のインスタンス。IDを持たず、状態が同じであれば同一とみなされる
  - オブジェクト：IDと状態を持つインスタンス。状態が時間によって変化する
- ドメインモデルはオブジェクト間のコミュニケーションに宿る
  - 静的なクラス表現は物事の一側面しか表現できない
- 命じよ、訊ねるな（デメテルの掟）
  - オブジェクトが意思決定を行う際、内部情報orトリガとなるメッセージ情報だけを元にせよ
  - 他のオブジェクトを操って何かを引き起こすことはさける
  - `Obj.getA().getB().setSavingFlag(true)`を一つの関数`allowSavingOfCustomisations()` にまとめることで、実装を隠蔽
- しかし、ときに訊ねることもある
  - コレクションから情報取り出し等は尋ねざるを得ない。でも、表現力は保つこと。
  - ``carriage.getSeats().getPercentReserved() < threshold`` は `carriage.hasSeatsAvailableWithin(threshold)` とすべし
- 内部状態は極力露呈させない・外部とのやり取りを中心にせよ…を守るオブジェクトをテストするには？
  - 隣接モジュールをモックする。テスト対象のオブジェクトだけをテストしたい＆隣接オブジェクトがどういうものかはわかっているため
#### 第三章「ツールの紹介」
- JUnit4
  - `@Test` のついたメソッドをテストとして扱う
  - `@Test(expected=例外) `で例外が出ることを期待するテストもかける
  - `@Before` でフィクスチャ（テスト開始時点で定められた状態）をセットアップできる。 `@After` がティアダウン
- Hamcrest
  - オブジェクトがマッチする条件を宣言的にかける
    - `Matcher<String> containBananas = new StringContains("banana"); assertFalse(containsBananas.matches(inputString)); ` みたいな
    - スタティックファクトリーを用いると `assertThat(inputString, not(containString("banana")))` とかかける
- jMock2の紹介
